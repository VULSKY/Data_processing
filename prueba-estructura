import pandas as pd
import json
from tkinter import Tk, filedialog

# ================================
# CONFIGURACI√ìN
# ================================
FILAS_POR_HOJA = 20            # Ajusta el n√∫mero de filas a extraer
ARCHIVO_SALIDA = "salida.json"

# ================================
# FUNCI√ìN PARA SELECCIONAR ARCHIVO
# ================================
def seleccionar_excel():
    root = Tk()
    root.withdraw()
    ruta = filedialog.askopenfilename(
        title="Selecciona el archivo Excel",
        filetypes=[("Archivos Excel", "*.xlsx *.xlsm *.xlsb")]
    )
    return ruta

# ================================
# LECTURA DEL EXCEL
# ================================
def excel_a_json(ruta_excel, filas_max=20):
    xls = pd.ExcelFile(ruta_excel)
    data = {}
    
    for hoja in xls.sheet_names:
        df = pd.read_excel(ruta_excel, sheet_name=hoja)
        df_recortado = df.head(filas_max)
        data[hoja] = df_recortado.fillna("").to_dict(orient="records")
    
    return data

# ================================
# PROGRAMA PRINCIPAL
# ================================
if __name__ == "__main__":
    print("Selecciona el archivo Excel...")
    ruta_excel = seleccionar_excel()

    if not ruta_excel:
        print("‚ùå No seleccionaste ning√∫n archivo.")
        exit()

    print(f"üìÑ Archivo seleccionado: {ruta_excel}")
    
    print("Leyendo y convirtiendo el archivo...")
    json_data = excel_a_json(ruta_excel, FILAS_POR_HOJA)

    with open(ARCHIVO_SALIDA, "w", encoding="utf-8") as f:
        json.dump(json_data, f, ensure_ascii=False, indent=4)

    print("‚úÖ Archivo generado:", ARCHIVO_SALIDA)
    print("\n=== Copia este JSON y p√©galo en ChatGPT ===\n")
    print(json.dumps(json_data, ensure_ascii=False, indent=4))
